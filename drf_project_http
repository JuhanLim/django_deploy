server {
  # 80 port로 서버 오픈
  listen 80;
  server_name 175.45.204.163 dromii.duckdns.org;
  

  location /admin/ { 
    proxy_pass http://unix:/root/django_deploy/drf_project.sock;
    add_header Cross-Origin-Opener-Policy same-origin;    #corp 설정 
    add_header Cross-Origin-Embedder-Policy require-corp;
  }
  location /api/ { 
    proxy_pass http://unix:/root/django_deploy/drf_project.sock;
    # CORS 헤더 추가
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization';
    add_header 'Access-Control-Allow-Credentials' 'true';
    add_header Cross-Origin-Opener-Policy same-origin;
    add_header Cross-Origin-Embedder-Policy require-corp;

  }
  location / { 
    root /root/django_deploy/DroMii_KWOS/build;
    index index.html index.htm;
    #try_files $uri $uri/ /index.html; -> nginx 기본 인덱스로가서 주석처리함 
  }
   
  # /images 경로로 요청이 들어왔을 때 연결되는 경로

  location /images/ {
	  root /root/django_deploy/static/;
  }

  #static files 
  location /static/ {
	  root /root/django_deploy/DroMii_KWOS/build/; # DroMii_KWOS/build/;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization';
    add_header Cross-Origin-Opener-Policy same-origin;  # 다른곳에서 CORS 인증 오류 안뜨도록 
    add_header Cross-Origin-Embedder-Policy require-corp;
    #try_files $uri $uri/ /root/django_deploy/DroMii_KWOS/build/; # $uri;
  }

    # krpano files
  location /krpano/ {
    root /root/django_deploy/DroMii_KWOS/build/;
  }

# alias 는 

    # GeoServer를 위한 location 블록
  location /geoserver/ {
          proxy_pass http://175.45.204.163:8080/geoserver/;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
  }
      # React 애플리케이션을 위한 location 블록
  # location /Mappage/ {
  #   proxy_pass http://175.45.204.163:3000/Mappage;
  #   proxy_set_header Host $host;
  #   proxy_set_header X-Real-IP $remote_addr;
  #   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  #   proxy_set_header X-Forwarded-Proto $scheme;
  # }
  # location / {
  #   proxy_pass http://175.45.204.163:3000/;
  #   proxy_set_header Host $host;
  #   proxy_set_header X-Real-IP $remote_addr;
  #   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  #   proxy_set_header X-Forwarded-Proto $scheme;
  # }  
}